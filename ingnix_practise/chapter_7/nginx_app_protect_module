# Problem - You need to install and configure the NGINX Plus App Protect Module.

user nginx;
worker_processes auto;

load_module modules/ngx_http_app_protect_module.so;

# ... Other main context directives

http {
	app_protect_enable on;
	app_protect_policy_file "/etc/nginx/AppProtectTransparentPolicy.json";
	app_protect_security_log_enable on;
	app_protect_security_log "/etc/nginx/log-default.json"
	  syslog:server=127.0.0.1:515;

	# ... Other http context directives
}

# To configure the default NGINX App Protect Policy

{
	"policy": {
		"name": "transparent_policy",
		"template": { "name": "POLICY_TEMPLATE_NGINX_BASE" },
		"applicationLanguage": "utf-8",
		"enforcementMode": "transparent"
	}
}


# To enable blocking

{
	"policy": {
		"name": "blocking_policy",
		"template": { "name": "POLICY_TEMPLATE_NGINX_BASE" },
		"aplicationLanguage": "utf-8",
		"enforcements": "blocking"	
	}
}

# To enable some of the protection features of App Protect, enable some violations

{
	"policy": {
		"name": "blocking_policy",
		"template": { "name": "POLICY_TEMPLATE_NGINX_BASE" },
		"applicationLanguage": "utf-8",
		"enforecmentMode": "blocking",
		"blocking-settings": {
			"violations": [
			{
				"name": "VIOL_JSON_FORMAT",
				"alarm": true,
				"block": true
			},
			{
				"name": "VIOL_PARAMETER_VALUE_METACHAR",
				"alarm": true,
				"block": false
			}	
			]
		}
	}
}

# To setup an NGINX Plus logging file, named /etc/nginx/log-default.json:
{
	"filter": {
		"request_type":"all"
	},
	"content": {
		"format": "default",
		"max_request_size": "any",
		"max_message_size": "5k"
	}
}
